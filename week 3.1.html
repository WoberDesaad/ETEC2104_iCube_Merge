<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Trackball Prototype 1</title>
	</head>
	<body>
		<canvas id="MainCanvas" width="800" height="800"></canvas>				
		<script>
		
			// setup canvas						//  FOR FUTURE REFERENCE  --------->      open the Web console  in your web browser and you can see things printed by console.log();
												// Also sensitivity doesn't seem to effect rolling speed
			var canvas = document.getElementById('MainCanvas');
			canvas.style.position = 'absolute';
			canvas.style.left = '0px';
			canvas.style.top = '0px';
			
			var ctx = canvas.getContext('2d');
			
			var old_mouse_x;
			var old_mouse_y;
			
			// add listeners for mouse events
			
			canvas.addEventListener('mousedown', function(event) {
				if (trackball.state === 'STOPPED'){   // change check if sensitivity buttons are checked   THIS WON'T RUN IF THE BALL IS MOVING!
				
					var cur_mouse_x = event.clientX;
                    var cur_mouse_y = event.clientY;
					console.log(cur_mouse_x,",", cur_mouse_y);
					console.log(sens_add.x+sens_add.width);
					
						
						if ((sens_add.x <= cur_mouse_x) && (cur_mouse_x <= sens_add.x+sens_add.width) &&  (sens_add.y <= cur_mouse_y) && (cur_mouse_y <= sens_add.y+sens_add.height)){
						// checks if inside the add rectangle
							
							console.log("yippe!");
							if (trackball.sensitivity ==9){								// prevents too high sensitivity
								console.log("YOU'VE GONE TOO FAR!!!!!!")
							
							}
							else{
								trackball.sensitivity += 1;
								console.log("your sensitivity has been increased to... ", trackball.sensitivity);
							}
							
						
						
						
						
						}
				
				
				
				

						
						if ((sens_sub.x <= cur_mouse_x) && (cur_mouse_x <= sens_sub.x+sens_sub.width) &&  (sens_sub.y <= cur_mouse_y) && (cur_mouse_y <= sens_sub.y+sens_sub.height)){
							// checks if in the sub rectangle
							
							console.log("yippe!");
							if (trackball.sensitivity ==1){
								console.log("You can't play with zero sensitivity...")							// prevents too low sensitivity
							
							}
							else{	
								trackball.sensitivity -= 1;														// decreases sensitivity and prints to console log
								console.log("your sensitivity has been decreased to... ", trackball.sensitivity);
							}				
							
							
							
						}
				
				
				}
				
				
				
			    if (trackball.state === 'STOPPED' ||
			        trackball.state === 'SPINNING')
			    {
                    var cur_mouse_x = event.clientX;
                    var cur_mouse_y = event.clientY;
                    
                    var dist2 = Distance2(cur_mouse_x, cur_mouse_y,
                        trackball.x, trackball.y);
                    
                    if (dist2 <= trackball.radius * trackball.radius)
                    {
						old_mouse_x = cur_mouse_x;
						old_mouse_y = cur_mouse_y;
						trackball.state = 'ROLLING';
					}
				}
			});
			
			canvas.addEventListener('mouseup', function(event) {
				if (trackball.state === 'ROLLING')
				{
					var cur_mouse_x = event.clientX;
					var cur_mouse_y = event.clientY;
					var dist2 = Distance2(cur_mouse_x, cur_mouse_y,
						trackball.x, trackball.y);
					if (dist2 <= trackball.radius * trackball.radius)
					{
						trackball.state = 'STOPPED';
					}
				}
			});
			
			canvas.addEventListener('mousemove', function(event) {
				if (trackball.state === 'ROLLING')
				{
				    var cur_mouse_x = event.clientX;
                    var cur_mouse_y = event.clientY;
                    var rel_mouse_x = cur_mouse_x - old_mouse_x;
                    var rel_mouse_y = cur_mouse_y - old_mouse_y;
                    
                    var dist2 = Distance2(cur_mouse_x, cur_mouse_y,
                        trackball.x, trackball.y);
                    
                    if (dist2 <= trackball.radius * trackball.radius)
                    {
						old_mouse_x = cur_mouse_x;
						old_mouse_y = cur_mouse_y;
						
						x_line.angle += rel_mouse_x * trackball.sensitivity;
						y_line.angle += rel_mouse_y * trackball.sensitivity;
                    }
                    else
                    {
                        trackball.state = 'SPINNING';
                        trackball.vx = rel_mouse_x;
                        trackball.vy = rel_mouse_y;
                    }
                }
			});
			
			// objects
			
			var sens_add = {
				'x' : 70,
				'y' : 20,
				'width' : 40,
				'height': 20,
				'color' : 'rgb(15,75,200)'
			
			
			
			
			
			
			};
			//  Both sens_add and sens_sub allow for interchangable xs and ys.  Change x or y and the button should stay intact.  Unless you use a negative, then it might break.
			// Also it should be noted that if you change the width or height, the button will still work but the symbols in the center will not.  
			// The symbols locations are based of the edge plus a small number.  It could be changed to a percentage of the width/height at some point.
			
			
			
			var sens_sub = {
				'x' : 20,
				'y' : 20,
				'width' : 40,
				'height': 20,
				'color' : 'rgb(200,75,15)'
			
			
			
			
			
			
			};			
			
			var trackball = {
				'x' : Math.floor(canvas.width / 2),
				'y' : canvas.height - 335,
				'radius' : 125,
				'vx' : 0.0,
				'vy' : 0.0,
				'color' : 'rgb(255, 0, 0)',
				'sensitivity' : 2.0,
				'state' : 'STOPPED'
			};
			
			var x_line = {
				'x' : 110,
				'y' : 110,
				'length' : 100,
				'width' : 5,
				'angle' : 0.0,
				'color' : 'rgb(0, 255, 0)'
			};
			
			var y_line = {
				'x' : canvas.width - 110,
				'y' : 110,
				'length' : 100,
				'width' : 5,
				'angle' : 0.0,
				'color' : 'rgb(255, 255, 0)'
			};
			
			// functions
			
			var start = null;
			function MainLoop(timestamp)
			{
				if (start === null) start = timestamp;
				var dtime = timestamp - start;
				start = timestamp;
				
				if (trackball.state === 'SPINNING')
				{
				    x_line.angle += trackball.vx;
				    y_line.angle += trackball.vy;
				    trackball.vx *= 0.94;
				    trackball.vy *= 0.94;
				    
				    var length2 = trackball.vx * trackball.vx + trackball.vy * trackball.vy;
				    if (length2 <= 1)
				    {
				        trackball.vx = 0.0;
				        trackball.vy = 0.0;
				        trackball.state = 'STOPPED';
				    }
				    
				}
				
				ctx.fillStyle = 'rgb(0, 180, 255)';
				ctx.fillRect(0, 0, canvas.width, canvas.height);
				
				DrawTrackball();
				DrawLine(x_line);
				DrawLine(y_line);
				DrawSens_Sub();									// draws the sub button
				DrawSens_Add();									// draws the add button
				
				
				
				// draws the symbols for both the add and sub buttons
				DrawSym(Math.floor((sens_add.x+sens_add.x+sens_add.width)/2), sens_add.y+2, Math.floor((sens_add.x+sens_add.x+sens_add.width)/2) , (sens_add.y + 18) );
				DrawSym(sens_add.x + 10, Math.floor((sens_add.y+sens_add.y+sens_add.height)/2), sens_add.x + 30, Math.floor((sens_add.y+sens_add.y+sens_add.height)/2));
				DrawSym(sens_sub.x + 10, Math.floor((sens_sub.y+sens_sub.y+sens_sub.height)/2), sens_sub.x + 30, Math.floor((sens_sub.y+sens_sub.y+sens_sub.height)/2));
				
				
				requestAnimationFrame(MainLoop);
			}
			
			function DrawTrackball()
			{
				ctx.beginPath();
				ctx.arc(trackball.x, trackball.y, trackball.radius,
					0, Math.PI * 2);
				ctx.fillStyle = trackball.color;
				ctx.fill();
			}
			
			function DrawSens_Add()								// works as the draw function for the add button
			{	
				
			
			var c=document.getElementById("MainCanvas");
			var ctx=c.getContext("2d");
			ctx.fillStyle = 'rgb(0, 0, 255)';
			ctx.fillRect(sens_add.x,sens_add.y,sens_add.width,sens_add.height);
			
			
			
			
			
			}
			function DrawSens_Sub()							//  works as the draw function for the subtract button
			{
				
			
			var c=document.getElementById("MainCanvas");
			var ctx=c.getContext("2d");
			ctx.fillStyle = 'rgb(35, 200, 54)';
			ctx.fillRect(sens_sub.x,sens_sub.y,sens_sub.width,sens_sub.height);
			
			
			
			
			
			
			}
			
			function DrawSym(x, y , width, height){							// works as the draw function for the symbols on both the buttons
				ctx.beginPath();
				ctx.moveTo(x, y);
				ctx.lineTo(width, height);
				ctx.strokeStyle = "red";
				ctx.lineWidth = 5;
				ctx.stroke();
			
			
			
			
			
			}
			
			function DrawLine(line)
			{
				ctx.beginPath();
				ctx.moveTo(line.x, line.y);
				
				var angle_rad = (Math.PI / 180.0) * line.angle;
				var x2 = line.x + line.length * Math.cos(angle_rad);
				var y2 = line.y - line.length * Math.sin(angle_rad);
				
				ctx.lineTo(x2, y2);
				ctx.strokeStyle = line.color;
				ctx.lineWidth = line.width;
				ctx.stroke();
			}
			
			function Distance2(x0, y0, x1, y1)
			{
				return (x1 - x0) * (x1 - x0) + (y1 - y0) * (y1 - y0);
			}
			
			function Distance(x0, y0, x1, y1)
			{
				return Math.sqrt(Distance2(x0, y0, x1, y1));
			}
			
			// start our main loop
			window.requestAnimationFrame(MainLoop);
			
		</script>
	</body>
</html>
